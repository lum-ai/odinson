<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/odinson/assets/css/just-the-docs-default.css"> <script src="/odinson/assets/js/vendor/lunr.min.js"></script> <script src="/odinson/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Metadata Query Language | odinson</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Metadata Query Language" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Odinson is a powerful and highly optimized open-source framework for rule-based information extraction. Odinson couples a simple, yet powerful pattern language that can operate over multiple representations of text, with a runtime system that operates in near real time." /> <meta property="og:description" content="Odinson is a powerful and highly optimized open-source framework for rule-based information extraction. Odinson couples a simple, yet powerful pattern language that can operate over multiple representations of text, with a runtime system that operates in near real time." /> <link rel="canonical" href="https://docs.lum.ai/odinson/odinson/metadata.html" /> <meta property="og:url" content="https://docs.lum.ai/odinson/odinson/metadata.html" /> <meta property="og:site_name" content="odinson" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Metadata Query Language" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Odinson is a powerful and highly optimized open-source framework for rule-based information extraction. Odinson couples a simple, yet powerful pattern language that can operate over multiple representations of text, with a runtime system that operates in near real time.","headline":"Metadata Query Language","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://docs.lum.ai/odinson/odinson/images/odinson_with_logo.png"}},"url":"https://docs.lum.ai/odinson/odinson/metadata.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/odinson/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="odinson"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/odinson/" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/odinson/contributors.html" class="nav-list-link">Contributors</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/odinson/installation.html" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item "><a href="/odinson/walkthrough.html" class="nav-list-link">Walkthrough Example</a></li><li class="nav-list-item "><a href="/odinson/docker.html" class="nav-list-link">Docker</a></li><li class="nav-list-item "><a href="/odinson/documents.html" class="nav-list-link">Creating Odinson Documents</a></li><li class="nav-list-item "><a href="/odinson/making_index.html" class="nav-list-link">Creating an Index</a></li></ul></li><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in Queries category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/odinson/queries.html" class="nav-list-link">Queries</a><ul class="nav-list"><li class="nav-list-item "><a href="/odinson/token_constraints.html" class="nav-list-link">Token Constraints</a></li><li class="nav-list-item "><a href="/odinson/graph_traversals.html" class="nav-list-link">Graph Traversals</a></li><li class="nav-list-item "><a href="/odinson/basic_queries.html" class="nav-list-link">Basic Queries</a></li><li class="nav-list-item "><a href="/odinson/event_queries.html" class="nav-list-link">Event Queries</a></li><li class="nav-list-item "><a href="/odinson/parent_queries.html" class="nav-list-link">Parent Queries</a></li><li class="nav-list-item "><a href="/odinson/quantifiers.html" class="nav-list-link">Quantifiers</a></li><li class="nav-list-item "><a href="/odinson/strings.html" class="nav-list-link">Strings</a></li><li class="nav-list-item active"><a href="/odinson/metadata.html" class="nav-list-link active">Metadata Query Language</a></li></ul></li><li class="nav-list-item"><a href="/odinson/shell.html" class="nav-list-link">Odinson shell</a></li><li class="nav-list-item"><a href="/odinson/offline-documentation.html" class="nav-list-link">Offline Documentation</a></li><li class="nav-list-item"><a href="/odinson/testing.html" class="nav-list-link">Testing</a></li><li class="nav-list-item"><a href="/odinson/troubleshooting.html" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item"><a href="/odinson/contributing.html" class="nav-list-link">Contributing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search odinson" aria-label="Search odinson" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/odinson/queries.html">Queries</a></li> <li class="breadcrumb-nav-list-item"><span>Metadata Query Language</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="metadata-query-language"> <a href="#metadata-query-language" class="anchor-heading" aria-labelledby="metadata-query-language"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metadata Query Language </h1> <p>Sometimes when we perform queries in Odinson we are only interested in a subset of the results. Maybe we are only interested in extractions from documents written by a particular author, or published in a specific venue, or maybe we only care about documents published recently. Odinson can index metadata associated to each document, which can be used to filter the results of a query through a metadata filter query.</p> <p>Odinson supports two main types of metadata: <strong>numeric</strong> and <strong>textual</strong>.</p> <h3 id="numeric-metadata"> <a href="#numeric-metadata" class="anchor-heading" aria-labelledby="numeric-metadata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Numeric Metadata </h3> <p>Numeric metadata can be compared using the common comparison operators used in most programming languages: equals (<code class="language-plaintext highlighter-rouge">==</code>), not equals (<code class="language-plaintext highlighter-rouge">!=</code>), less than (<code class="language-plaintext highlighter-rouge">&lt;</code>), greater than (<code class="language-plaintext highlighter-rouge">&gt;</code>), less than or equals (<code class="language-plaintext highlighter-rouge">&lt;=</code>), and greater than or equals (<code class="language-plaintext highlighter-rouge">&gt;=</code>). One of the elements being compared must be an indexed <em>metadata field</em>, and the other must be a <em>numeric value</em>, e.g., <code class="language-plaintext highlighter-rouge">citations &gt; 5</code>. These comparisons can be chained together, allowing us to express ranges in a more concise way, e.g., <code class="language-plaintext highlighter-rouge">1 &lt; citations &lt; 10</code>.</p> <ul> <li>Field type to use: ai.lum.odinson.NumberField</li> </ul> <h3 id="textual-metadata"> <a href="#textual-metadata" class="anchor-heading" aria-labelledby="textual-metadata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Textual Metadata </h3> <p>From those comparison operators, textual metadata only supports the equals (<code class="language-plaintext highlighter-rouge">==</code>) and not equals (<code class="language-plaintext highlighter-rouge">!=</code>) operators. Equals checks for exact matching, e.g., <code class="language-plaintext highlighter-rouge">publisher == 'mit press'</code>. Note that the textual content is wrapped in quotation marks.</p> <p>Sometimes exact textual matching can be too stringent, and a containment check can be more appropriate. This can be accomplished with the <code class="language-plaintext highlighter-rouge">contains</code> operator, e.g., <code class="language-plaintext highlighter-rouge">venue contains 'language'</code>. To specify that a metadata field should <em>not</em> contain a given text, you can use: <code class="language-plaintext highlighter-rouge">venue not contains 'language'</code></p> <p>To make textual comparison more robust, we perform some normalization of the textual metadata fields.</p> <ul> <li>unicode-aware case folding</li> <li>NFKC unicode normalization</li> <li>some unicode characters are transformed into ASCII equivalents (e.g., arrows, ligatures, etc.)</li> <li> <p>removal of diacritics</p> </li> <li>Field type to use: ai.lum.odinson.TokensField (Note, assumes the text is tokenized.)</li> </ul> <h3 id="combining-filters"> <a href="#combining-filters" class="anchor-heading" aria-labelledby="combining-filters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Combining Filters </h3> <p>The metadata query language supports the and (<code class="language-plaintext highlighter-rouge">&amp;&amp;</code>), or (<code class="language-plaintext highlighter-rouge">||</code>), and not (<code class="language-plaintext highlighter-rouge">!</code>) operators to combine individual field constraints into a more complex filter, e.g., <code class="language-plaintext highlighter-rouge">1 &lt; citations &lt; 10 &amp;&amp; venue contains 'language'</code>.</p> <h3 id="dates"> <a href="#dates" class="anchor-heading" aria-labelledby="dates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dates </h3> <p>The metadata query language offers special support for dates using the <code class="language-plaintext highlighter-rouge">date</code> function, which returns a numeric representation of the date. As such, you can write queries against dates as you would with other numeric metadata. For example, <code class="language-plaintext highlighter-rouge">date(2020, 'Jan', 1) &lt; pub_date &lt;= date(2020, 'Dec', 31)</code> would return documents published in 2020. This provides a lot of flexibility when checking for specific dates, but since checking for years is a common use case, we provide a shortcut. The query presented above can also be expressed as <code class="language-plaintext highlighter-rouge">pub_date.year == 2020</code>. Months can be expressed as their full names, common abbreviations, or number (i.e., “August”, “Aug”, or 8).</p> <ul> <li>Field type to use: ai.lum.odinson.DateField</li> </ul> <h3 id="nested-fields"> <a href="#nested-fields" class="anchor-heading" aria-labelledby="nested-fields"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Nested Fields </h3> <p>Another capability of the metadata query language is its support for nested metadata fields. For example, authors are usually indexed as nested fields so that their first and last name are associated with each other, and <em>not</em> with other authors. To query nested fields, we need to specify the name of the field and the query to be performed on it. For example, if we had a document with two authors named <em>Jane Smith</em> and <em>John Doe</em>, then we could match this document with the queries <code class="language-plaintext highlighter-rouge">author{first=='jane' &amp;&amp; last=='smith'}</code> or <code class="language-plaintext highlighter-rouge">author{first=='john' &amp;&amp; last =='doe'}</code>, but not <code class="language-plaintext highlighter-rouge">author{first=='jane' &amp;&amp; last=='doe'}</code>. Not all attributes of a nested field must be specified. For example, given the authors above, this would also match: <code class="language-plaintext highlighter-rouge">author{first=='jane'}</code></p> <ul> <li>Field type to use: ai.lum.odinson.NestedField</li> </ul> <h3 id="regular-expressions"> <a href="#regular-expressions" class="anchor-heading" aria-labelledby="regular-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Regular Expressions </h3> <p>The metadata query language also supports Lucene regular expressions, such as:</p> <ul> <li><code class="language-plaintext highlighter-rouge">author{first=='/j.*/' &amp;&amp; last=='/d.*/'}</code></li> <li><code class="language-plaintext highlighter-rouge">keywords contains '/bio.*/'</code></li> </ul> <h3 id="adding-metadata-to-existing-odinson-documents"> <a href="#adding-metadata-to-existing-odinson-documents" class="anchor-heading" aria-labelledby="adding-metadata-to-existing-odinson-documents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adding Metadata to Existing Odinson Documents </h3> <p>As of <a href="https://github.com/lum-ai/odinson/pull/319">PR #319</a>, there are some utilities and an app to help you add metadata to an Odinson document.</p> <ul> <li>there is an <code class="language-plaintext highlighter-rouge">addMetadata</code> method in <code class="language-plaintext highlighter-rouge">ai.lum.odinson.Document</code> that take a sequence of Fields and adds them as metadata.</li> <li>there is now a <code class="language-plaintext highlighter-rouge">MetadataWrapper</code> case class that can serialize itself in a compatible json format</li> <li>in the <code class="language-plaintext highlighter-rouge">extra/</code> subproject, there is an app (<code class="language-plaintext highlighter-rouge">ai.lum.odinson.extra.AddMetadataToDocuments</code>) that will load a set of metadata json files and a set of Document json files, and add any found metadata to the corresponding Document (as indicated by the docID in the metadata file).</li> </ul> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
