<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/odinson/assets/css/just-the-docs-default.css"> <script src="/odinson/assets/js/vendor/lunr.min.js"></script> <script src="/odinson/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Walkthrough Example | odinson</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Walkthrough Example" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Odinson is a powerful and highly optimized open-source framework for rule-based information extraction. Odinson couples a simple, yet powerful pattern language that can operate over multiple representations of text, with a runtime system that operates in near real time." /> <meta property="og:description" content="Odinson is a powerful and highly optimized open-source framework for rule-based information extraction. Odinson couples a simple, yet powerful pattern language that can operate over multiple representations of text, with a runtime system that operates in near real time." /> <link rel="canonical" href="https://docs.lum.ai/odinson/odinson/walkthrough.html" /> <meta property="og:url" content="https://docs.lum.ai/odinson/odinson/walkthrough.html" /> <meta property="og:site_name" content="odinson" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Walkthrough Example" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Odinson is a powerful and highly optimized open-source framework for rule-based information extraction. Odinson couples a simple, yet powerful pattern language that can operate over multiple representations of text, with a runtime system that operates in near real time.","headline":"Walkthrough Example","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://docs.lum.ai/odinson/odinson/images/odinson_with_logo.png"}},"url":"https://docs.lum.ai/odinson/odinson/walkthrough.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/odinson/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="odinson"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/odinson/" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/odinson/contributors.html" class="nav-list-link">Contributors</a></li><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/odinson/installation.html" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item active"><a href="/odinson/walkthrough.html" class="nav-list-link active">Walkthrough Example</a></li><li class="nav-list-item "><a href="/odinson/docker.html" class="nav-list-link">Docker</a></li><li class="nav-list-item "><a href="/odinson/documents.html" class="nav-list-link">Creating Odinson Documents</a></li><li class="nav-list-item "><a href="/odinson/making_index.html" class="nav-list-link">Creating an Index</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Queries category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/odinson/queries.html" class="nav-list-link">Queries</a><ul class="nav-list"><li class="nav-list-item "><a href="/odinson/token_constraints.html" class="nav-list-link">Token Constraints</a></li><li class="nav-list-item "><a href="/odinson/graph_traversals.html" class="nav-list-link">Graph Traversals</a></li><li class="nav-list-item "><a href="/odinson/basic_queries.html" class="nav-list-link">Basic Queries</a></li><li class="nav-list-item "><a href="/odinson/event_queries.html" class="nav-list-link">Event Queries</a></li><li class="nav-list-item "><a href="/odinson/parent_queries.html" class="nav-list-link">Parent Queries</a></li><li class="nav-list-item "><a href="/odinson/quantifiers.html" class="nav-list-link">Quantifiers</a></li><li class="nav-list-item "><a href="/odinson/strings.html" class="nav-list-link">Strings</a></li><li class="nav-list-item "><a href="/odinson/metadata.html" class="nav-list-link">Metadata Query Language</a></li></ul></li><li class="nav-list-item"><a href="/odinson/shell.html" class="nav-list-link">Odinson shell</a></li><li class="nav-list-item"><a href="/odinson/offline-documentation.html" class="nav-list-link">Offline Documentation</a></li><li class="nav-list-item"><a href="/odinson/testing.html" class="nav-list-link">Testing</a></li><li class="nav-list-item"><a href="/odinson/troubleshooting.html" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item"><a href="/odinson/contributing.html" class="nav-list-link">Contributing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search odinson" aria-label="Search odinson" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/odinson/installation.html">Getting Started</a></li> <li class="breadcrumb-nav-list-item"><span>Walkthrough Example</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="walkthrough-example"> <a href="#walkthrough-example" class="anchor-heading" aria-labelledby="walkthrough-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Walkthrough Example </h1> <p>As an example of a typical usage of Odinson, imagine that you have a collection of text documents, from which you would like to extract mentions of pet adoptions. (A more cheerful example than, say, bombing events!) For this example, weâ€™ll use a single text file:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sally loves dogs.  Yesterday, Sally adopted a cat named Ajax. 
</code></pre></div></div> <h2 id="step-1-annotate-the-text"> <a href="#step-1-annotate-the-text" class="anchor-heading" aria-labelledby="step-1-annotate-the-text"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Annotate the text </h2> <p>which is saved as <code class="language-plaintext highlighter-rouge">data/pets/text/text_1.txt</code>. The next step is to annotate the text and build an Odinson index, both of which are offline steps. For this, your config file (<code class="language-plaintext highlighter-rouge">extra/src/main/resources/application.conf</code>) should read:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> odinson.textDir = data/pets/text
 odinson.docDir = data/pets/docs
 odinson.indexDir = data/pets/index
</code></pre></div></div> <p>To create the annotated Odinson documents, run this command from the project root directory:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt "extra/runMain ai.lum.odinson.extra.AnnotateText"
</code></pre></div></div> <p>The Odinson Document for the above text, created with one example Processor is here, but keep in mind that the fields you include in an Odinson Document are largely up to you!</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Document(6a2b13bf-515f-49fe-a4f3-b3a04aaf3bef,List(),ArraySeq(Sentence(4,List(TokensField(raw,WrappedArray(Sally, loves, dogs, .),true), TokensField(word,WrappedArray(Sally, loves, dogs, .),false), TokensField(tag,WrappedArray(NNP, VBZ, NNS, .),false), TokensField(lemma,WrappedArray(Sally, love, dog, .),false), TokensField(entity,WrappedArray(PERSON, O, O, O),false), TokensField(chunk,WrappedArray(B-NP, B-VP, B-NP, O),false), GraphField(dependencies,List((1,0,nsubj), (1,2,dobj), (1,3,punct)),Set(1),false))), Sentence(9,List(TokensField(raw,WrappedArray(Yesterday, ,, Sally, adopted, a, cat, named, Ajax, .),true), TokensField(word,WrappedArray(Yesterday, ,, Sally, adopted, a, cat, named, Ajax, .),false), TokensField(tag,WrappedArray(NN, ,, NNP, VBD, DT, NN, VBN, NNP, .),false), TokensField(lemma,WrappedArray(yesterday, ,, Sally, adopt, a, cat, name, Ajax, .),false), TokensField(entity,WrappedArray(DATE, O, PERSON, O, O, O, O, ORGANIZATION, O),false), TokensField(chunk,WrappedArray(B-NP, O, B-NP, B-VP, B-NP, I-NP, B-VP, B-NP, O),false), GraphField(dependencies,List((3,2,nsubj), (3,5,dobj), (3,8,punct), (3,0,nmod:tmod), (3,1,punct), (5,4,det), (5,6,acl), (6,7,xcomp)),Set(3),false)))))
</code></pre></div></div> <h2 id="step-2-create-the-index"> <a href="#step-2-create-the-index" class="anchor-heading" aria-labelledby="step-2-create-the-index"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Create the index </h2> <p>Then, to make the index, you can either run the provided app:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt "extra/runMain ai.lum.odinson.extra.IndexDocuments"
</code></pre></div></div> <p>Or, if customization is needed, you can use these steps in your own code:</p> <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ai.lum.common.FileUtils._</span>
<span class="k">import</span> <span class="nn">ai.lum.odinson.Document</span>
<span class="k">import</span> <span class="nn">ai.lum.odinson.lucene.index.OdinsonIndexWriter</span>

<span class="c1">// Initialize the index writer</span>
<span class="k">val</span> <span class="nv">writer</span> <span class="k">=</span> <span class="nv">OdinsonIndexWriter</span><span class="o">.</span><span class="py">fromConfig</span><span class="o">()</span>

<span class="c1">// Gather the Document files to be indexed</span>
<span class="k">val</span> <span class="nv">wildcards</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"*.json"</span><span class="o">,</span> <span class="s">"*.json.gz"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">files</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"data/pets/docs"</span><span class="o">).</span><span class="py">listFilesByWildcards</span><span class="o">(</span><span class="n">wildcards</span><span class="o">,</span> <span class="n">recursive</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>

<span class="c1">// Iterate through the files, and add each to the index</span>
<span class="nv">files</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="n">f</span> <span class="k">=&gt;</span> <span class="nv">writer</span><span class="o">.</span><span class="py">addFile</span><span class="o">(</span><span class="n">f</span><span class="o">))</span>

<span class="c1">// Close the index</span>
<span class="nv">writer</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
</code></pre></div></div> <h2 id="step-3-use-the-index-for-queries"> <a href="#step-3-use-the-index-for-queries" class="anchor-heading" aria-labelledby="step-3-use-the-index-for-queries"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3: Use the index for queries </h2> <p>Once the index is built, we can query it to get the information we are interested in. To do this, we first need to make an extractor engine, then pass it queries to apply.</p> <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ai.lum.odinson.</span><span class="o">{</span><span class="nc">EventMatch</span><span class="o">,</span> <span class="nc">ExtractorEngine</span><span class="o">,</span> <span class="nc">NamedCapture</span><span class="o">,</span> <span class="nc">OdinsonMatch</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">ai.lum.odinson.utils.DisplayUtils.displayMention</span>

<span class="c1">// Initialize the extractor engine -- ensure that your config still has `odinson.indexDir` pointing</span>
<span class="c1">// to where you wrote your index, here we were using data/pets/index</span>
<span class="k">val</span> <span class="nv">extractorEngine</span> <span class="k">=</span> <span class="nv">ExtractorEngine</span><span class="o">.</span><span class="py">fromConfig</span><span class="o">()</span>

<span class="c1">// Here we have a set of two rules, which will first find `Pet` mentions, and the find </span>
<span class="c1">// `Adoption` Mentions.</span>
<span class="k">val</span> <span class="nv">rules</span> <span class="k">=</span> <span class="s">"""
    |rules:
    |  - name: pets_type
    |    type: basic
    |    label: Pet  # if found, will have the label "Pet"
    |    priority: 1 # will run in the first round of extraction
    |    pattern: |
    |       [lemma=/cat|dog|bunny|fish/]
    |
    |  - name: pets_adoption
    |    type: event
    |    label: Adoption
    |    priority: 2  # will run in the second round of extraction, can reference priority 1 rules
    |    pattern: |
    |      trigger = [lemma=adopt]
    |      adopter = &gt;nsubj []   # note: we didn't specify the label, so any token will work
    |      pet: Pet = &gt;dobj []
    """</span><span class="o">.</span><span class="py">stripMargin</span>

<span class="c1">// Compile the rules into Extractors that will be used with the Index</span>
<span class="k">val</span> <span class="nv">extractors</span> <span class="k">=</span> <span class="nv">extractorEngine</span><span class="o">.</span><span class="py">compileRuleString</span><span class="o">(</span><span class="n">rules</span><span class="o">)</span>

<span class="c1">// Extract Mentions</span>
<span class="k">val</span> <span class="nv">mentions</span> <span class="k">=</span> <span class="nv">extractorEngine</span><span class="o">.</span><span class="py">extractMentions</span><span class="o">(</span><span class="n">extractors</span><span class="o">)</span>

<span class="c1">// Display the mentions</span>
<span class="nv">mentions</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="nf">displayMention</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">extractorEngine</span><span class="o">))</span>
</code></pre></div></div> <p>The output of the above code is:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------------------------------
Mention Text: adopted
Label: Adoption
Found By: pets_adoption
  Trigger: adopted
  Args:
    * pet [Pet]: cat
    * adopter [no label]: Sally

------------------------------
Mention Text: dogs
Label: Pet
Found By: pets_type

------------------------------
Mention Text: cat
Label: Pet
Found By: pets_type
</code></pre></div></div> <h3 id="additional-example-usage"> <a href="#additional-example-usage" class="anchor-heading" aria-labelledby="additional-example-usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Additional example usage </h3> <p>For an example usage, please see the complete working example <a href="https://github.com/lum-ai/odinson/blob/master/extra/src/main/scala/ai/lum/odinson/extra/Example.scala">here</a>.</p> <p>To run it from the command line, use:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbt extra/run
</code></pre></div></div> <p>and choose <code class="language-plaintext highlighter-rouge">Example</code> off the list.</p> <p>To use it, you will need to point to an Odinson index by specifying the correct path in <code class="language-plaintext highlighter-rouge">application.conf</code>. If you need help making an index, or setting up your config file, there is info <a href="https://github.com/lum-ai/odinson/tree/master/extra">here</a>.</p> <p>The file containing the Odinson rules being used in this example is <a href="https://github.com/lum-ai/odinson/blob/master/extra/src/main/resources/example/rules.yml">here</a>, and the output is a json lines file, with one line per extraction. Please note that this example is meant to be illustrative only, and the output produced is not a true serialization of the extracted Mentions (i.e., only some attributes are included in the output).</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
